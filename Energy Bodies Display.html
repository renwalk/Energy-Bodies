<!DOCTYPE html>
<!-- saved from url=(0034)http://localhost:8000/display.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <title>Energy Bodies Display</title>

  <!-- p5 core -->
  <script src="./Energy Bodies Display_files/p5.min.js"></script>

  <!-- p5 addons -->
// <script src="./Energy Bodies Display_files/p5.sound.min.js"></script>

  <!-- ml5.js -->
  <script src="./Energy Bodies Display_files/ml5.min.js"></script><style type="text/css" data-glamor=""></style>

  <!-- Your Energy Bodies sketch -->
  <script src="./Energy Bodies Display_files/sketch.js"></script>
</head>
<body data-new-gr-c-s-check-loaded="14.1252.0" data-gr-ext-installed="">
<script>
let socket;

window.addEventListener('load', () => {
  console.log("✅ display.html loaded, starting WebSocket...");

// Get current hostname from the page URL (works for both laptop + iPad)
const host = window.location.hostname;

// Connect to WebSocket server on same host at port 8080
socket = new WebSocket(`ws://${host}:8080`);



  socket.onopen = () => {
    console.log("✅ CONNECTED to WebSocket server");
  };

  socket.onerror = (err) => {
    console.error("❌ WebSocket error:", err);
  };

  socket.onmessage = (event) => {
    // If Blob → convert to string
    if (event.data instanceof Blob) {
      const reader = new FileReader();
      reader.onload = () => {
        handleIncomingMessage(reader.result);
      };
      reader.readAsText(event.data);
    } else {
      handleIncomingMessage(event.data);
    }
  };

  function handleIncomingMessage(message) {
    let data;
    try {
      data = JSON.parse(message);
    } catch (err) {
      console.warn("❌ Invalid JSON from WebSocket:", message);
      return;
    }

    // ✅ Update emotion sliders in memory
    if (data.emotion && window.emotionSliders) {
      for (let name in data.emotion) {
        if (window.emotionSliders[name] && typeof window.emotionSliders[name].value === "function") {
          window.emotionSliders[name].value(data.emotion[name]);
        }
      }
    }

    // ✅ Update region sliders in memory
    if (data.region && window.regionSliders) {
      for (let name in data.region) {
        if (window.regionSliders[name] && typeof window.regionSliders[name].value === "function") {
          window.regionSliders[name].value(data.region[name]);
        }
      }
    }

    // ✅ Handle start/stop tracking
    if (data.action === "start" && typeof window.startTracking === "function") {
      window.startTracking();
    }
    if (data.action === "stop" && typeof window.stopTracking === "function") {
      window.stopTracking();
    }
  }
});
</script>


<main><canvas id="defaultCanvas0" class="p5Canvas" width="1898" height="1836" style="width: 949px; height: 918px;"></canvas></main><canvas width="1898" height="1836" style="display: none; width: 949px; height: 918px;"></canvas><canvas width="1898" height="1836" style="display: none; width: 949px; height: 918px;"></canvas><canvas width="1898" height="1836" style="display: none; width: 949px; height: 918px;"></canvas><div class="calendly-frame-tag" manager_id="7a0fd905-0914-4d53-b71f-d10a9818cc52" id="7a0fd905-0914-4d53-b71f-d10a9818cc52" style="height: 0px; width: 0px; visibility: hidden;"></div></body><grammarly-desktop-integration data-grammarly-shadow-root="true"><template shadowrootmode="open"><style>
      div.grammarly-desktop-integration {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select:none;
        user-select:none;
      }

      div.grammarly-desktop-integration:before {
        content: attr(data-content);
      }
    </style><div aria-label="grammarly-integration" role="group" tabindex="-1" class="grammarly-desktop-integration" data-content="{&quot;mode&quot;:&quot;full&quot;,&quot;isActive&quot;:true,&quot;isUserDisabled&quot;:false}"></div></template></grammarly-desktop-integration></html>